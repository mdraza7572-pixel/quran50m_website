<style>
    /* --- 1. HEADER PROFILE ICON (New) --- */
    /* Is code ko header ke andar set karna padega via JS or manual placement */
    .profile-btn {
        width: 40px; height: 40px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        display: flex; align-items: center; justify-content: center;
        cursor: pointer; transition: 0.3s;
        margin-left: 10px;
    }
    .profile-btn:hover { background: #FFD700; color: black; border-color: #FFD700; }
    .profile-btn i { font-size: 1.2rem; }

    /* --- 2. LOGIN MODAL (Manish Verma Style) --- */
    .login-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0, 0, 0, 0.6); z-index: 10001; /* Sabse upar */
        display: none; align-items: center; justify-content: center;
        backdrop-filter: blur(8px);
    }
    .login-card {
        background: white; width: 90%; max-width: 380px;
        border-radius: 24px; padding: 30px 25px;
        text-align: center; color: #333;
        box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        font-family: 'Outfit', sans-serif;
        animation: zoomIn 0.3s ease-out; position: relative;
    }
    @keyframes zoomIn { from {transform: scale(0.9); opacity: 0;} to {transform: scale(1); opacity: 1;} }
    
    .login-logo img { width: 70px; height: 70px; border-radius: 18px; margin-bottom: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .login-title { font-size: 1.5rem; font-weight: 800; margin-bottom: 5px; color: #000; }
    .login-subtitle { font-size: 0.9rem; color: #666; margin-bottom: 25px; }
    
    .login-input {
        width: 100%; padding: 15px; border: 1px solid #ddd;
        border-radius: 12px; font-size: 1rem; margin-bottom: 15px;
        background: #f8f9fa; outline: none; transition: 0.3s;
    }
    .login-input:focus { border-color: #2563eb; background: #fff; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }
    
    .btn-main {
        width: 100%; padding: 15px; background: #2563eb; color: white;
        border: none; border-radius: 50px; font-size: 1rem; font-weight: 600;
        cursor: pointer; margin-bottom: 10px; transition: 0.3s;
    }
    .btn-main:hover { background: #1d4ed8; transform: translateY(-2px); }
    
    .btn-close {
        width: 100%; padding: 15px; background: #f1f5f9; color: #475569;
        border: none; border-radius: 50px; font-size: 1rem; font-weight: 600;
        cursor: pointer; transition: 0.3s;
    }
    .btn-close:hover { background: #e2e8f0; }

    /* --- 3. FLOATING ICONS (Chat & Book) --- */
    .float-btn {
        position: fixed; bottom: 25px;
        width: 60px; height: 60px;
        background: rgba(10, 10, 10, 0.6); 
        border: 2px solid #FFD700;
        border-radius: 50%; display: flex; align-items: center; justify-content: center;
        cursor: pointer; z-index: 9990;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5); 
        transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(10px);
    }
    .float-btn:hover { transform: scale(1.1); background: rgba(255, 215, 0, 0.15); }
    .float-btn i { font-size: 24px; color: #FFD700; }
    
    /* Lock Badge (Red Dot) */
    .lock-badge {
        position: absolute; top: -2px; right: -2px;
        background: #ef4444; color: white; font-size: 10px;
        width: 22px; height: 22px; border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        border: 2px solid #111; box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }

    /* Positioning */
    #chatBtn { right: 20px; }  
    #bookBtn { left: 20px; }   

    /* --- CHAT WINDOW CSS (Same) --- */
    .chat-window {
        position: fixed; bottom: 95px; right: 20px;
        width: 350px; max-width: 90%; height: 500px;
        background: rgba(10, 10, 10, 0.95); backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 25px;
        display: none; flex-direction: column; overflow: hidden; z-index: 9999;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }
    .chat-header { padding: 15px; background: rgba(255, 215, 0, 0.1); border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; justify-content: space-between; align-items: center; color: #FFD700; font-weight: 700; }
    .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; font-size: 14px; }
    .msg { max-width: 80%; padding: 10px 14px; border-radius: 15px; line-height: 1.4; word-wrap: break-word; }
    .bot-msg { background: rgba(255, 255, 255, 0.1); color: #ddd; align-self: flex-start; border-bottom-left-radius: 4px; }
    .user-msg { background: linear-gradient(135deg, #FFD700 0%, #FDB931 100%); color: black; align-self: flex-end; font-weight: 600; border-bottom-right-radius: 4px; }
    .chat-input-area { padding: 12px; display: flex; gap: 10px; border-top: 1px solid rgba(255, 255, 255, 0.1); }
    .chat-input { flex: 1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 10px 14px; border-radius: 50px; color: #fff; outline: none; }
    .send-btn { width: 40px; height: 40px; border: none; border-radius: 50%; background: #FFD700; cursor: pointer; display: flex; align-items: center; justify-content: center; }
</style>

<div class="login-overlay" id="loginModal">
    <div class="login-card">
        <div class="login-logo"><img src="logo.png" alt="App Logo"></div>
        <div class="login-title">Welcome üëã</div>
        <div class="login-subtitle">Please enter your details to Register or Login.</div>
        
        <input type="text" id="userContact" class="login-input" placeholder="Enter Email or Phone Number">
        
        <button class="btn-main" onclick="handleLogin()">Continue</button>
        <button class="btn-close" onclick="closeLogin()">Close</button>
        
        <div style="font-size: 0.75rem; color: #999; margin-top: 20px;">
            By continuing, you agree to our Terms & Privacy Policy.
        </div>
    </div>
</div>

<div class="float-btn" id="bookBtn" onclick="checkAccess('book')">
    <i class="fas fa-book-open"></i>
    <div class="lock-badge" id="bookLock"><i class="fas fa-lock" style="font-size: 10px;"></i></div>
</div>

<div class="float-btn" id="chatBtn" onclick="checkAccess('chat')">
    <i class="fas fa-robot"></i>
    <div class="lock-badge" id="chatLock"><i class="fas fa-lock" style="font-size: 10px;"></i></div>
</div>

<div class="chat-window" id="chatWindow">
    <div class="chat-header">
        <span><i class="fas fa-mosque"></i> Islamic Assistant</span>
        <span style="cursor:pointer" onclick="toggleChat()"><i class="fas fa-times"></i></span>
    </div>
    <div class="chat-body" id="chatBody">
        <div class="msg bot-msg">Assalamu Alaikum! ü§ç Main Quran 50M ka AI Assistant hoon. Sawal poochiye.</div>
    </div>
    <div class="chat-input-area">
        <input id="userInput" class="chat-input" placeholder="Sawal likhein..." onkeydown="if(event.key==='Enter')sendMessage()">
        <button class="send-btn" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>

<script>
    // --- SETUP: ADD PROFILE ICON TO HEADER AUTOMATICALLY ---
    document.addEventListener("DOMContentLoaded", function() {
        // Dhundo ki header kahan hai aur usme icon daal do
        const header = document.querySelector('header');
        if(header) {
            // Check agar pehle se button hai to delete karo (duplication avoid karne ke liye)
            const oldBtn = document.getElementById('headerProfileBtn');
            if(oldBtn) oldBtn.remove();

            const profileBtn = document.createElement('div');
            profileBtn.id = 'headerProfileBtn';
            profileBtn.className = 'profile-btn';
            profileBtn.innerHTML = '<i class="fas fa-user"></i>';
            profileBtn.onclick = function() { checkAccess('profile'); };
            
            // Header ke andar last element ke roop mein add karo
            header.appendChild(profileBtn);
        }

        // Login Check
        if(localStorage.getItem("isLoggedIn") === "true") {
            unlockAll();
        }
    });

    let pendingAction = null; 

    function checkAccess(action) {
        const isLoggedIn = localStorage.getItem("isLoggedIn");
        
        if (isLoggedIn === "true") {
            // LOGGED IN ACTIONS
            if(action === 'chat') toggleChat();
            if(action === 'book') window.location.href = "books.html";
            if(action === 'profile') {
                const logout = confirm("Aap already logged in hain. Logout karna chahte hain?");
                if(logout) {
                    localStorage.removeItem("isLoggedIn");
                    location.reload(); // Refresh page to lock again
                }
            }
        } else {
            // LOGGED OUT ACTIONS (Show Modal)
            pendingAction = action;
            document.getElementById("loginModal").style.display = "flex";
        }
    }

    function handleLogin() {
        const contact = document.getElementById("userContact").value;
        if (contact.trim() === "") {
            alert("Please enter details!");
            return;
        }
        
        // Save Fake Login
        localStorage.setItem("isLoggedIn", "true");
        
        closeLogin();
        unlockAll();
        
        // Action Resume
        if(pendingAction === 'chat') setTimeout(() => toggleChat(), 500);
        else if(pendingAction === 'book') window.location.href = "books.html";
        else if(pendingAction === 'profile') alert("Login Successful! Welcome.");
    }

    function closeLogin() {
        document.getElementById("loginModal").style.display = "none";
        pendingAction = null;
    }

    function unlockAll() {
        document.getElementById("chatLock").style.display = "none";
        document.getElementById("bookLock").style.display = "none";
        
        // Profile Icon ka color change karo taaki pata chale login hai
        const pBtn = document.getElementById('headerProfileBtn');
        if(pBtn) {
            pBtn.style.background = "#FFD700";
            pBtn.style.color = "black";
        }
    }

    // --- GEMINI API LOGIC (Same as before) ---
    const API_KEY = "AIzaSyCFxGUeE_dCiARfRBFKNfElq9Y_fedz2dI";
    const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${API_KEY}`;

    function toggleChat(){
        const w = document.getElementById("chatWindow");
        w.style.display = w.style.display === "flex" ? "none" : "flex";
    }

    function appendMessage(text, type){
        const body = document.getElementById("chatBody");
        const div = document.createElement("div");
        div.className = "msg " + type;
        div.innerText = text;
        body.appendChild(div);
        body.scrollTop = body.scrollHeight;
        return div;
    }

    async function sendMessage(){
        const input = document.getElementById("userInput");
        const text = input.value.trim();
        if(!text) return;
        appendMessage(text, "user-msg");
        input.value = "";
        const loading = appendMessage("Typing...", "bot-msg");
        try{
            const res = await fetch(API_URL, {
                method: "POST", headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: "You are an Islamic assistant. Reply briefly. Question: " + text }] }] })
            });
            const data = await res.json();
            if(data.error) loading.innerText = "Error: " + data.error.message;
            else loading.innerText = data.candidates?.[0]?.content?.parts?.[0]?.text || "No reply.";
        } catch(e){ loading.innerText = "Net error ‚ùå"; }
    }
</script>
